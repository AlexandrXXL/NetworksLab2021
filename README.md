# NetworksLab2021

Рабочая версия программы (чат с возможностью отправки файлов).
## Компиляция и запуск
###На Linux: 
компиляция: ./comp.sh
запуск: ./start.sh
###На Windows: 
компиляция: javac -d bin ./src/*
запуск: для клиента - java Client, для сервера - java ServerTCP
##Описание протокола
###Сторона клиента
Клиент отправляет на сервер сообщение в виде команды, команда заканчивается символом перевода строки. Для разделения текста сообщения и имени файла используется зарезервированный символ '/'. Не самое оптимальное решение, так как контроль наличия '/' в тексте сообщения производится только на стороне клиента (Злоумышленник может отправить сообщение, в котором будет пресутствовать '/', что будет интерпретировано сервером, как наличие файла, в результате чего злоумышленник сможет "захламлять" память компьютера других пользователей, также возможна подмена поролей и других важных данных, поэтому не рекомендуется запускать клиентскую сторону от имени суперпользователя). После команды могут следовать 4 байта, отвечающие за длину файла, и сам файл. Принятие сообщений и их декодирование происходит согласно протоколу серверной стороны.
###Сторона сервера
Сервер принимает команду и кодирует сообщение в поток байт.
Формат пакета, отправляемого сервером:
####Поле type
1 Байт. Поле type хранит в себе информацию о типе пришедшего сообщения, определяется путем анализа пришедшей от клиента команды. Поле type определяет порядок и наличие остальных полей пакета. type = 0: Сообщение + файл, type = 1: Сообщение, type = 2 - файл.
####Поле time
8 Байт(long). Содержит серверное время в формате UTC (количество милисекунд, прошедшее с 1 января 1970г).
####Поле ul
4 Байт(int). Хранит длину юзернейма отправляющего.
####Username
Переменное количество байт, содержит юзернейм отправляющего.
####Необязательное поле ml
4 Байт(int). Хранит длину отправляемого текстового сообщения.
####Massage
Переменное количество байт, содержит текстовое сообщение.
####Необязательно поле fnl
4 Байт(int). Хранит длину имени отправляемого файла.
####Filename
Переменное количество байт, содержит имя отправляемого файла.
####Необязательное поле fl
4 Байт(int). Хранит длину отправляемого файла.
####File
Переменное количество байт, содержит файл.
###Ограничения
Для защиты используются ограничения на длину сообщений, контроль производится как на клиентской части, так и на серверной. На клиентской части в случае нарушения отправка сообщения будет отменена, на серверной части в случае нарушения от клиента, клиент будет принудительно отклюен.
 
